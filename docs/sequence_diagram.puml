@startuml

participant "Controller" as Controller
participant "Programmable Money" as Money
participant "Credentials Holder (Money sender and/or receiver)" as User
participant "Credentials Issuer" as Issuer
participant "Credentials Verifier" as Verifier
participant "Blockchain" as Blockchain

' --- Configure spending conditions of the money ---
group #lightgreen Spending Conditions Configuration
    Controller -> Money: specify spending condition (e.g., age > 18)
    opt if related credentials not exist
        Controller -> Issuer: define and publish credentials format
    end
end

group #lightsalmon Credentials Issuance
    opt if related credentials are missing
        ' --- Credential Request and Issuance Phase ---
        User -> Issuer: request credentials
        Issuer --> User: request supporting documents
        User --> Issuer: provide identity and personal data
        Issuer -> Issuer: perform identity attestation
        alt attestation outcome
            Issuer --> User: issue credentials
        else
            Issuer --> User: reject credential request
        end
    end
end

' --- Transaction Phase ---
group #lightblue Money Transaction
    User -> User: generate ZKP from credentials
    User -> Verifier: submit ZKP

    ' --- Proof Verification and Decision ---
    Verifier -> Verifier: validate credentials and verify ZKP
    alt verification outcome
        Verifier --> User: approve transaction
    else
        Verifier --> User: reject transaction
    end
    Verifier -> Blockchain: publish verification result
end

@enduml
