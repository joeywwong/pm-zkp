@startuml
participant "Optional: Credentials Schema Manager" as SchemaManager
participant "Credentials Issuer" as Issuer
participant "Credentials Holder" as User
participant "Credentials Verifier" as Verifier

' --- Credential Creation and Upload Phase ---
alt Schema Manager handles credentials definition and publish
    SchemaManager -> SchemaManager: Define and publish credential definitions
else Issuer handles credentials definition and publish
    Issuer -> Issuer: Define and publish credential definitions
end

note right of Issuer: Credential formats are pre-defined

' --- Optional Credential Request and Issuance Phase ---
opt Credential Request and Issuance (if not already requested)
    User -> Issuer: Request Credentials
    Issuer --> User: Request supporting documents
    User --> Issuer: Provide identity and personal data
    Issuer -> Issuer: Perform identity attestation
    alt Attestation Outcome
        Issuer --> User: Issue credentials
    else
        Issuer --> User: Reject credential request
    end
end

' --- Transaction Initiation Phase ---
User -> Verifier: Initiate Transaction
Verifier --> User: Specify spending condition (e.g., age > 18) and request ZKP
User -> User: Generate ZKP from credentials
User --> Verifier: Submit ZKP

' --- Proof Verification and Decision ---
Verifier -> Verifier: Validate credentials and verify ZKP
alt Proof is Valid and Conditions Satisfied
    Verifier --> User: Approve Transaction
else
    Verifier --> User: Reject Transaction
end

@enduml
